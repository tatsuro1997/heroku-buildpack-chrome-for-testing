#!/usr/bin/env bash

CHROME_VERSION="128.0.0.0"  # Chromeバージョンを指定
CHROMEDRIVER_VERSION="128.0.0"  # ChromeDriverバージョンを指定

BUILD_DIR=$1

echo "-----> Installing Chrome version ${CHROME_VERSION}"

# Chromeのインストール
curl -o /tmp/google-chrome-stable_${CHROME_VERSION}_amd64.deb https://dl.google.com/linux/chrome/deb/pool/main/g/google-chrome-stable/google-chrome-stable_${CHROME_VERSION}_amd64.deb
dpkg -x /tmp/google-chrome-stable_${CHROME_VERSION}_amd64.deb $BUILD_DIR/.apt/
rm /tmp/google-chrome-stable_${CHROME_VERSION}_amd64.deb

# ChromeDriverのインストール
echo "-----> Installing ChromeDriver version ${CHROMEDRIVER_VERSION}"
curl -o /tmp/chromedriver_linux64.zip https://chromedriver.storage.googleapis.com/${CHROMEDRIVER_VERSION}/chromedriver_linux64.zip
unzip /tmp/chromedriver_linux64.zip -d $BUILD_DIR/.apt/usr/bin
rm /tmp/chromedriver_linux64.zip

# 環境変数の設定
echo "export GOOGLE_CHROME_BIN=$BUILD_DIR/.apt/opt/google/chrome/chrome" > $BUILD_DIR/.profile.d/chrome.sh
echo "export CHROMEDRIVER_PATH=$BUILD_DIR/.apt/usr/bin/chromedriver" >> $BUILD_DIR/.profile.d/chrome.sh
